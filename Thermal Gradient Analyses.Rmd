---
title: "Thermal Gradient Analyses"
author: "Laura Segura Hern√°ndez"
date: "1/17/2023"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning=FALSE)
```

# Libraries
```{r, message=FALSE}
library(googlesheets4)
library(tidyr)
library(dplyr)
library(data.table)
library(lubridate)
library(NRES803)
library(ggplot2)
library(lme4)
library(DHARMa)
library(forcats)
library(gap)
```

# Signing up to my google account and getting the data sheet

I just need to run this line to give access to my google account to tidy verse to be able to work on the google sheet more easily

```{r, message=FALSE}
gs4_auth(email=TRUE)
```


Now I can read the ones I need:
```{r}

# Getting the behavior data
df<-read_sheet('https://docs.google.com/spreadsheets/d/1P7omRunnlCTOQz2YM8-oaBCRXCbVdOQ3CjWfBQ2ldrM/edit#gid=0', sheet="Raw data", na = c("", "NA","NULL", NULL))

df[is.null(df)]<-NA

df<-as.data.frame(df)
df<- df %>% 
  mutate(Zone=factor(Zone, levels=c("1","2", "3", "4","5","6", "7", "8", "9", "10", "11", "12", "13","End", "Non visible"))) %>%
  rename(trial=Trial, totalduration= `Duration secs`, lane=Lane, stage=Stage, zone=Zone, enter=Enter, time=`Time spent secs`,lines=`Lines crossed`,priorexpdur=`Prior exploration duration`, priorexpmin=`Prior exploration min`, priorexpmax=`Prior exploration max`)


#Getting the temperature data

temps<-range_read('https://docs.google.com/spreadsheets/d/1P7omRunnlCTOQz2YM8-oaBCRXCbVdOQ3CjWfBQ2ldrM/edit#gid=0', sheet="Temperatures", na = c("", "NA","NULL", NULL))

temps[is.null(df)]<-NA

as.data.frame(temps)


```

# Organizing the temperature data
```{r}

temps<-temps %>%
  select(-c("Channel 2", "Channel 9" ,"Channel 16")) %>%
  mutate(Zone=as.factor(Zone)) %>%
  rename(trial=Trial, meantemptrial=Trialaverage, zonegradient=Zonegradient, zone=Zone)

# Getting overall average of the temperature gradient across all trials
tempsb<- temps %>%
  group_by(zonegradient) %>%
  summarize(meantempall=mean(meantemptrial),
            setempall=sd(meantemptrial)/11,
            n=length(meantemptrial),
            sdtemptall=sd(meantemptrial))

# Adding that overall average to the temperatures of each trial
temps<-temps %>%
  full_join(tempsb, by="zonegradient")

# Separating temperatures per trial
temps1<-temps %>% filter(trial==1)
temps2<-temps %>% filter(trial==2)
temps3<-temps %>% filter(trial==3)
temps4<-temps %>% filter(trial==4)
temps5<-temps %>% filter(trial==5)
temps6<-temps %>% filter(trial==6)
temps7<-temps %>% filter(trial==7)
temps8<-temps %>% filter(trial==8)
temps9<-temps %>% filter(trial==9)
temps10<-temps %>% filter(trial==10)
temps11<-temps %>% filter(trial==11)



```

# Organizing the behavioral data

## Merging temperatures to each trial
```{r}
# Trial 1
df1<- df %>%
  filter(trial==1) %>%
  full_join(temps1, by="zone")

# Trial2
df2<- df %>%
  filter(trial==2) %>%
  full_join(temps2, by="zone")

# Trial 3
df3<- df %>%
  filter(trial==3) %>%
  full_join(temps3, by="zone")

# Trial 4
df4<- df %>%
  filter(trial==4) %>%
  full_join(temps4, by="zone")

# Trial 5
df5<- df %>%
  filter(trial==5) %>%
  full_join(temps5, by="zone")

# Trial 6
df6<- df %>%
  filter(trial==6) %>%
  full_join(temps6, by="zone")

# Trial 7
df7<- df %>%
  filter(trial==7) %>%
  full_join(temps7, by="zone")

# Trial 8
df8<- df %>%
  filter(trial==8) %>%
  full_join(temps8, by="zone")

# Trial 9
df9<- df %>%
  filter(trial==9) %>%
  full_join(temps9, by="zone")

# Trial 10
df10<- df %>%
  filter(trial==10) %>%
  full_join(temps10, by="zone")

# Trial 11
df11<- df %>%
  filter(trial==11) %>%
  full_join(temps11, by="zone")


```

## Merging all files together and adding "halves" division 
```{r}
beh1<-rbind(df1,df2,df3,df4,df5,df6,df7,df8,df9,df10,df11)
beh1%>% group_by(stage) %>% summarize(n=n_distinct(ID))
  

beh1<-beh1 %>% 
  filter(zone!="End") %>%
  mutate(proptime=time/totalduration)  %>%
  mutate(half=case_when(
    zonegradient<7~"Colder",
    zonegradient>7~"Hotter",
    zonegradient==7 ~"Middle", 
   TRUE~"NA"))

beh1<-beh1 %>%
  mutate(
    sides=case_when(
    zone %in% c("1", "2", "3", "4", "5", "6")~"Left",
    zone %in% c("8", "9", "10", "11", "12", "13") ~ "Right",
    zone == "7" ~ "Middle",
    TRUE~"NA"
  ),
  zone=as.factor(zone))


# Organizing order of the levels for each factor
beh1$stage <- fct_relevel(beh1$stage, "Protonymph", "Deutonymph", "Tritonymph",  "Male", "Female")
levels(beh1$stage) # new col is not attached so must use data$

beh1$half <- fct_relevel(beh1$half, "Colder", "Middle", "Hotter", "NA")
levels(beh1$half) # new col is not attached so must use data$

beh1$sides <- fct_relevel(beh1$sides, "Left", "Middle", "Right", "NA")
levels(beh1$sides) # new col is not attached so must use data$


```


## Triming so that all trials are the same length and removing escapees
```{r}
# I want all trials to be 59 minutes, or 3540 sec. So I filtered out all the rows that are above that duration and added a final row with the final value (3450sec)
beh2<-beh1 %>%
  filter(enter<3540) %>%
  group_by(ID) %>%
  group_modify(~add_row(.x,zone="End", enter=3540)) 

# I estimated the new duration for each row, that the the trials were trimmed
beh<-beh2 %>%
  group_by(ID) %>%
  mutate(time=lead(enter)-enter)

# Removing individuals that escaped
beh<-beh%>%
  filter(!ID %in% c(311, 56)) %>%
  filter(zone!="End")

beh2%>% group_by(stage) %>% summarize(n=n_distinct(ID))


levels(as.factor(beh1$ID))
levels(as.factor(beh$ID))
#NOTE: now the beh dataframe has all the trimmed values 

```

## Plotting to see if there are any weird (negrative) values
```{r}
# Colors
colors<-c("#ff7f00", "#e41a1c", "#a65628",  "#984ea3", "#377eb8")


ggplot(beh, aes(y=time, x=half, color=stage))+
    geom_boxplot() +
  scale_color_manual(values=colors)+
    theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none")+ 
  facet_wrap(~stage)

ggsave(plot=last_plot(),filename="boxplot_half_stages.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")

```
# Assessing data

## Looking at temperatures across trials

```{r}
d<-data.frame(zonegradient = c(1,13), meantemptrial = c(20,40))

temps$upr<-temps$meantempall+temps$sdtemptall
temps$lwr<-temps$meantempall-temps$sdtemptall

ggplot() +
  geom_line(temps, mapping=aes(x=zonegradient, y=meantemptrial, color=as.factor(trial)), size=0.7)+
  geom_point(temps,mapping=aes(x=zonegradient,y=meantemptrial, color=as.factor(trial)), size=2, alpha=0.5)+
  geom_line(temps, mapping=aes(x=zonegradient, y=meantempall), color="black", size=0.5)+
  geom_ribbon(data=temps, mapping=aes(ymin = lwr, ymax = upr,x=zonegradient, y=meantempall), alpha = 0.7, color="black")+
  theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)), strip.text.x = element_blank(),panel.spacing = unit(7, "mm"))+
  labs(color="Trial")+ylab("Temperature (Celsius)")+xlab("Zone")+
  scale_x_continuous(breaks=c(1,2,3,4,5,6,7,8,9,10,11,12,13))+ 
  geom_line(data = d, mapping =aes(x = zonegradient, y = meantemptrial), colour = "red", size=1.5, linetype="dashed")

ggsave(plot=last_plot(),filename="Temperature_trials.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")


ggplot() +
  geom_line(temps, mapping=aes(x=zonegradient, y=meantempall), color="black", size=1.5)+
  geom_ribbon(data=temps, mapping=aes(ymin = lwr, ymax = upr, x=zonegradient, y=meantempall), alpha = 0.5, color="black")
  #theme_classic()+
  #theme(text = element_text(size = 15), plot.title = element_text(size = (12)), strip.text.x = element_blank(),panel.spacing = unit(7, "mm"))+
  #labs(color="Trial")+ylab("Temperature (Celsius)")+xlab("Zone")+
  #scale_x_continuous(breaks=c(1,2,3,4,5,6,7,8,9,10,11,12,13))+ 
  #geom_line(data = d, mapping =aes(x = zonegradient, y = meantemptrial), colour = "red", size=1.5, linetype="dashed")

  
```


## Checking for biases on arena sides (left vs right side for the warmer end)

### Plots
```{r}
# Colors
colors<-c("#ff7f00", "#e41a1c", "#a65628",  "#984ea3", "#377eb8")

# Grouping by stages

ggplot(beh, aes(y=time, x=sides, color=stage))+
    geom_boxplot() +
  scale_color_manual(values=colors)+
    theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none")+ 
  facet_wrap(~stage) + xlab("Side of the arena")+  ylab("Time spent (s)")

ggsave(plot=last_plot(),filename="boxplot_sides_stages.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")


behch<-beh%>%
  group_by(stage,sides) %>%
  summarize(timesum=sum(time), timeav=mean(time),timesd=sd(time), n=length(time)) %>%
  mutate(timese=timesd/sqrt(n),
         timeav2=timesum/n,
         timese=timesd/sqrt(n))

ggplot(behch, aes(y=timesum, x=sides, fill=stage))+
  geom_bar(stat="identity")+
  scale_fill_manual(values=colors)+
   theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none")+ 
  facet_wrap(~stage)  + xlab("Side of the arena")+  ylab("Cumulative time (s)")
ggsave(plot=last_plot(),filename="Sides_all_ttime.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")
 


ggplot(behch, aes(y=timeav, x=sides, color=stage))+
    geom_jitter(beh, mapping=aes(x=sides, y=time, color=stage),shape=1, size=3, stroke=1.2, width=0.1) +
  geom_point(size=3, color="black") +geom_errorbar(aes(ymin=timeav-timese, ymax=timeav+timese), width=.2,
                 position=position_dodge(.9), color="black")  + theme_classic()+
  scale_color_manual(values=colors)+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none")+ 
  facet_wrap(~stage)  + xlab("Side of the arena")+  ylab("Mean time (s)")
ggsave(plot=last_plot(),filename="Sides_all_avtime.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")
 

ggplot(behch, aes(y=timeav, x=sides, color=stage))+
    geom_point(size=3) +geom_errorbar(aes(ymin=timeav-timese, ymax=timeav+timese), width=.2,
                 position=position_dodge(.9))  + theme_classic()+
  scale_color_manual(values=colors)+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none")+ 
  facet_wrap(~stage)  + xlab("Side of the arena")+  ylab("Mean time (s)")
ggsave(plot=last_plot(),filename="Sides_all_avtime2.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")
 

# All Together
behch2<-beh%>%
  group_by(sides) %>%
  summarize(timesum=sum(time), timeav=mean(time),timesd=sd(time), n=length(time)) %>%
  mutate(timese=timesd/sqrt(n),
         timeav2=timesum/n,
         timese=timesd/sqrt(n))

ggplot(behch2, aes(y=timesum, x=sides))+
  geom_bar(stat="identity")+ theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none")  + xlab("Side of the arena")+  ylab("Cumulative time (s)")

ggsave(plot=last_plot(),filename="Sides_together_ttime.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")
 


ggplot(behch2, aes(y=timeav, x=sides))+
    geom_jitter(beh, mapping=aes(x=sides, y=time, color=stage),shape=1, size=3, stroke=1.2, width=0.1) +
  geom_point(size=3, color="black") +geom_errorbar(aes(ymin=timeav-timese, ymax=timeav+timese), width=.2,
                 position=position_dodge(.9), color="black")  + theme_classic()+
  scale_color_manual(values=colors)+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none") + xlab("Side of the arena")+  ylab("Time (s)")
ggsave(plot=last_plot(),filename="Sides_together_avtime.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in") 
 

ggplot(behch2, aes(y=timeav, x=sides))+
    geom_point(size=3) +geom_errorbar(aes(ymin=timeav-timese, ymax=timeav+timese), width=.2,
                 position=position_dodge(.9))  + theme_classic()+
  scale_color_manual(values=colors)+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none")  + xlab("Side of the arena")+  ylab("Mean time (s)")
ggsave(plot=last_plot(),filename="Sides_together_avtime2.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")
 



```

### Binomial test
```{r}
# Per individual

side2<- beh %>%
  group_by(stage, ID, sides) %>%
  summarize(timesum=sum(time)) 

side3<-complete(side2, sides, fill=list(timesum=0)) %>%
  filter(!sides %in% c("Middle", "NA") )%>%
  group_by(ID) %>%
  mutate(ttime=sum(timesum)) %>%
  filter(sides=="Left") %>%
  filter(ID !=45)

## Getting a p-vaue for each individual
bt <- function(a, b, p = 0.5) {binom.test(a, b, 0.5, alternative=
                            c("two.sided"), conf.level = 0.95)$p.value}
side3$pval <- mapply(bt, side3$timesum, side3$ttime)



## Plotting P-values
ggplot(side3, aes(y=pval, x=sides, color=stage)) +geom_jitter() + geom_hline(yintercept=0.05, linetype="dashed")


# all together
side2<- beh %>%
  group_by(sides) %>%
  summarize(timesum=sum(time)) 

side3<-complete(side2, sides, fill=list(timesum=0)) %>%
  filter(!sides %in% c("Middle", "NA") )%>%
  mutate(ttime=sum(timesum))# %>%
  #filter(sides=="Left")

side3$pval <- binom.test(side3$timesum, side3$ttime, 0.5)$p.value

bt1<-binom.test(261198, 509639	, 0.5)
binom.test(248441, 509639	, 0.5)

bt1$p.value

# Both sides differ from 50%

```

### Anova / comparing means 
```{r}

# Comparing mean time per "stay" per ID
m1<-lm(timeav~sides, data=behch)
summary(m1)
NRES803::check_assumptions(m1)

# Comparing cumulative time per ID
m2<-lm(timesum~sides+stage, data=behch)
summary(m2)
NRES803::check_assumptions(m2)





```




## Total time spent on each temperature zone 

### Cumulative time per ID and stage 

#### Data prep

```{r}
#Protonymphs
protos<-beh %>% filter(stage=="Protonymph") 

protos2<-protos%>%
  group_by(ID, meantemptrial, zone, trial.x) %>%
  summarize(time=sum(time), proptime=sum(proptime))

#Deutonymphs
deutos<-beh %>% filter(stage=="Deutonymph")

deutos2<-deutos%>%
  group_by(ID, meantemptrial, zone, trial.x) %>%
  summarize(time=sum(time), proptime=sum(proptime))

#Tritonymphs
tritos<-beh %>% filter(stage=="Tritonymph")

tritos2<-tritos%>%
  group_by(ID, meantemptrial, zone, trial.x) %>%
  summarize(time=sum(time), proptime=sum(proptime))

#Males
males<-beh %>% filter(stage=="Male")

males2<-males%>%
  group_by(ID, meantemptrial, zone, trial.x) %>%
  summarize(time=sum(time), proptime=sum(proptime))

#Females
females<-beh %>% filter(stage=="Female")

females2<-females%>%
  group_by(ID, meantemptrial, zone, trial.x) %>%
  summarize(time=sum(time), proptime=sum(proptime))

# All stages in a single frame
cumtime<-beh %>%
  group_by(stage, ID, meantempall, zone, trial.x) %>%
  summarize(time=sum(time))


```

#### Plots: total time

```{r}
# To add the ID labels to the grid, remove the "strip.text.x = element_blank()" for in the code line: 
#theme(text = element_text(size = 15), plot.title = element_text(size = (12)), strip.text.x = element_blank(),panel.spacing = unit(7, "mm"),legend.position="none")+


## Protonymphs
ggplot(protos2, aes(x=meantemptrial, y=time, fill=as.factor(trial.x))) +geom_bar(stat="identity", width=1) + 
  theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(1, "mm"), strip.text.x = element_text(size=8, face="bold"))+
  xlab("Temperature (Celsius)")+  ylab("Cumulative time (s)")+ ggtitle("Protonymphs by ID")+
  labs(fill="Trial")+ 
  facet_wrap(vars(ID), scales="fixed") + geom_vline(xintercept=35, linetype="dashed", color="black")

ggsave(plot=last_plot(),filename="Acummtime_ind_trial_Protos.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")


## Deutonymphs
ggplot(deutos2, aes(x=meantemptrial, y=time, fill=as.factor(trial.x))) +geom_bar(stat="identity", width=1) + 
  theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(1, "mm"), strip.text.x = element_text(size=8, face="bold"))+
  xlab("Temperature (Celsius)")+  ylab("Cumulative time (s)")+ ggtitle("Deutonymphs by ID")+
  labs(fill="Trial")+ 
  facet_wrap(vars(ID), scales="fixed")+ geom_vline(xintercept=35, linetype="dashed", color="black")

ggsave(plot=last_plot(),filename="Acummtime_ind_trial_Deutos.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")


## Tritonymphs

### By individual
ggplot(tritos2, aes(x=meantemptrial, y=time, fill=as.factor(trial.x))) +geom_bar(stat="identity", width=1) + 
  theme_classic()+
   theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(1, "mm"), strip.text.x = element_text(size=8, face="bold"))+
  xlab("Temperature (Celsius)")+  ylab("Cumulative time (s)")+ ggtitle("Tritonymphs by ID")+
  labs(fill="Trial")+ 
  facet_wrap(vars(ID), scales="fixed")+ geom_vline(xintercept=35, linetype="dashed", color="black")

ggsave(plot=last_plot(),filename="Acummtime_ind_trial_tritos.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")


## Males

### By individual
ggplot(males2, aes(x=meantemptrial, y=time, fill=as.factor(trial.x))) +geom_bar(stat="identity", width=1) + 
  theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(1, "mm"), strip.text.x = element_text(size=8, face="bold"))+
  xlab("Temperature (Celsius)")+  ylab("Cumulative time (s)")+ ggtitle("Males by ID")+
  labs(fill="Trial")+ 
  facet_wrap(vars(ID), scales="fixed")+ geom_vline(xintercept=35, linetype="dashed", color="black")
ggsave(plot=last_plot(),filename="Acummtime_ind_trial_males.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")


## Females
ggplot(females2, aes(x=meantemptrial, y=time, fill=as.factor(trial.x))) +geom_bar(stat="identity", width=1) + 
  theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(1, "mm"), strip.text.x = element_text(size=8, face="bold"))+
  xlab("Temperature (Celsius)")+  ylab("Cumulative time (s)")+ ggtitle("Females by ID")+
  labs(fill="Trial")+ 
  facet_wrap(vars(ID), scales="fixed")+ geom_vline(xintercept=35, linetype="dashed", color="black")

ggsave(plot=last_plot(),filename="Acummtime_ind_trial_females.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")



```





### Cumulative total time

#### Data prep

```{r}
### Protonymphs
protos3<-protos%>%
  group_by(meantempall, zonegradient) %>%
  summarize(time=sum(time), proptime=sum(proptime))

### Deutonymphs
deutos3<-deutos%>%
  group_by(meantempall, zonegradient) %>%
  summarize(time=sum(time), proptime=sum(proptime))


### Tritonymphs
tritos3<-tritos%>%
  group_by(meantempall, zonegradient) %>%
  summarize(time=sum(time), proptime=sum(proptime))


### Males
males3<-males%>%
  group_by(meantempall, zonegradient) %>%
  summarize(time=sum(time), proptime=sum(proptime))


### Females
females3<-females%>%
  group_by(meantempall, zonegradient) %>%
  summarize(time=sum(time), proptime=sum(proptime))

### All stages in single dataframe
cumtime2<-beh%>%
  group_by(stage, meantempall, zonegradient) %>%
  summarize(time=sum(time))



```


#### Plots: Total time



```{r}
### Protonymphs
ggplot(protos3, aes(x=meantempall, y=time)) +geom_bar(stat="identity", fill="#ff7f00") + 
  theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)), strip.text.x = element_blank(),panel.spacing = unit(7, "mm"),legend.position="none")+
  xlab("Temperature (Celsius)")+  ylab("Cumulative time (s)")+ ggtitle("Protonymphs all together")

ggsave(plot=last_plot(),filename="Acummtime_trial_Protos.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")

### Deutonymphs
ggplot(deutos3, aes(x=meantempall, y=time)) +geom_bar(stat="identity", fill="#e41a1c") + 
  theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)), strip.text.x = element_blank(),panel.spacing = unit(7, "mm"),legend.position="none")+
  xlab("Temperature (Celsius)")+  ylab("Cumulative time (s)")+ ggtitle("Deutonymphs all together")

ggsave(plot=last_plot(),filename="Acummtime_trial_Deutos.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")

### Tritonymphs
ggplot(tritos3, aes(x=meantempall, y=time)) +geom_bar(stat="identity", fill="#a65628") + 
  theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)), strip.text.x = element_blank(),panel.spacing = unit(7, "mm"),legend.position="none")+
  xlab("Temperature (Celsius)")+  ylab("Cumulative time (s)")+ ggtitle("Tritonymphs all together")

ggsave(plot=last_plot(),filename="Acummtime_trial_tritos.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")

### Males
ggplot(males3, aes(x=meantempall, y=time)) +geom_bar(stat="identity", fill="#984ea3") + 
  theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)), strip.text.x = element_blank(),panel.spacing = unit(7, "mm"),legend.position="none")+
  xlab("Temperature (Celsius)")+  ylab("Cumulative time (s)")+ ggtitle("Males all together")

ggsave(plot=last_plot(),filename="Acummtime_trial_males.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")

### Females
ggplot(females3, aes(x=meantempall, y=time)) +geom_bar(stat="identity", fill="#377eb8") + 
  theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)), strip.text.x = element_blank(),panel.spacing = unit(7, "mm"),legend.position="none")+
  xlab("Temperature (Celsius)")+  ylab("Cumulative time (s)")+ ggtitle("Females all together")

ggsave(plot=last_plot(),filename="Acummtime_trial_females.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")


# All together
ggplot(cumtime2, aes(x=meantempall, y=time)) + geom_bar(stat="identity", aes(fill=stage)) + 
  theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)), strip.text.x = element_blank(),panel.spacing = unit(7, "mm"),legend.position="none")+
  xlab("Temperature (Celsius)")+  ylab("Cumulative time (s)")+ ggtitle("All together by stage") +
  scale_fill_manual(values=colors) +
  facet_wrap(vars(stage))+ geom_vline(xintercept=35, linetype="dashed", color="black")

ggsave(plot=last_plot(),filename="Acummtime_trial_all.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")


```









## Average time spent

### Data prep
```{r}
### Protonymphs
protos3<-protos%>%
  group_by(meantempall, zone) %>%
  summarize(time=sum(time), proptime=sum(proptime))



behav3<-beh%>%
  group_by(stage, meantempall, zonegradient) %>%
  summarize(avtime=mean(time), sdtime=sd(time)/sqrt(length(time))) %>%
  na.omit()


ggplot(behav3, aes(x=meantempall, y=avtime, fill=stage)) +geom_bar(stat="identity") + 
  theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none")+
  xlab("Temperature (Celsius)")+  ylab("Mean time (s)")+ ggtitle("Mean time across all IDs")+
  scale_fill_manual(values=colors) + 
  geom_errorbar(aes(ymin=avtime-sdtime, ymax=avtime+sdtime), width=.2,
                 position=position_dodge(.9)) +
  facet_wrap(vars(stage))+ geom_vline(xintercept=35, linetype="dashed", color="black")

ggsave(plot=last_plot(),filename="Avtime_stages_se.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")

ggplot(behav3, aes(x=meantempall, y=avtime, fill=stage)) +geom_bar(stat="identity") + 
  theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none")+
  xlab("Temperature (Celsius)")+  ylab("Mean time (s)")+ ggtitle("Mean time across all IDs")+
  scale_fill_manual(values=colors) +
  facet_wrap(vars(stage))+ geom_vline(xintercept=35, linetype="dashed", color="black")

ggsave(plot=last_plot(),filename="Avtime_stages.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")



```








# Dividing between hot and cold

## All stages at once
```{r}
behch<-beh%>%
  group_by(stage,half) %>%
  summarize(timesum=sum(time), proptimesum=sum(proptime), timeav=mean(time),timesd=sd(time), n=length(time), proptimeav=mean(proptime), proptimesd=sd(proptime), n2=length(proptime)) %>%
  mutate(timese=timesd/sqrt(n),
         timeav2=timesum/n,
         timese=timesd/sqrt(n),
         proptimese=proptimesd/sqrt(n2))

ggplot(behch, aes(y=timesum, x=half, fill=stage))+
  geom_bar(stat="identity")+
  scale_fill_manual(values=colors)+
   theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none")+ 
  facet_wrap(~stage) + xlab("Position in arena")+  ylab("Cumulative time (s)")
ggsave(plot=last_plot(),filename="Half_all_ttime.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")
 


ggplot(behch, aes(y=timeav, x=half, color=stage))+
    geom_jitter(beh, mapping=aes(x=half, y=time, color=stage),shape=1, size=3, stroke=1.2, width=0.1) +
  geom_point(size=3, color="black") +geom_errorbar(aes(ymin=timeav-timese, ymax=timeav+timese), width=.2,
                 position=position_dodge(.9), color="black")  + theme_classic()+
  scale_color_manual(values=colors)+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none")+ 
  facet_wrap(~stage) + xlab("Position in arena")+  ylab("Time spent (s)")
ggsave(plot=last_plot(),filename="Half_all_avtime.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")
 

ggplot(behch, aes(y=timeav, x=half, color=stage))+
    geom_point(size=3) +geom_errorbar(aes(ymin=timeav-timese, ymax=timeav+timese), width=.2,
                 position=position_dodge(.9))  + theme_classic()+
  scale_color_manual(values=colors)+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none")+ 
  facet_wrap(~stage)+ xlab("Position in arena")+  ylab("Mean time (s)")
ggsave(plot=last_plot(),filename="Half_all_avtime2.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")
 






```
# Organizing data for exploration (line crossing)

```{r}
behlinesprep<-beh %>%
  filter(zone!="Non visible") %>%
  mutate(zone=as.numeric(zone)) %>%
  group_by(ID) %>%
  mutate(lines=case_when(
    length(enter)==1~0,
    TRUE~abs(lag(zone)-zone)))


behlines<-behlinesprep %>%
  filter(!is.na(lines))%>%
  group_by(stage, ID) %>%
  summarize(explore=sum(lines))

levels(as.factor(df$ID))
levels(as.factor(beh$ID))
levels(as.factor(behlines$ID))



```


## Looking at exploration data
```{r}
behl<-behlines%>%
  group_by(stage) %>%
  summarize(expav=mean(explore),expsd=sd(explore), n=length(explore)) %>%
  mutate(expse=expsd/sqrt(n),
         expse=expsd/sqrt(n))

ggplot(behl, aes(y=expav, x=stage) )+
    geom_point(behlines, mapping=aes(x=stage, y=explore, color=stage),shape=1, size=3, stroke=1.2, width=0.1) +
  geom_point(size=3, color="black", position=position_nudge(x=0.2)) +geom_errorbar(aes(ymin=expav-expse, ymax=expav+expse), width=.2,
                 position=position_nudge(x=0.2), color="black")  + theme_classic()+
  scale_color_manual(values=colors)+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none") + xlab("Stage")+  ylab("Number of zones crossed")

ggsave(plot=last_plot(),filename="Exploration.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")

```


# Looking at temperature with most time spent
## Organizing data for getting the temperature they spent most time at
```{r}
# Extractng, per Id and Trial, which zone did they spent most time at in a single "stay"?
behpref<-beh %>%
   filter(zone!="Non visible") %>%
  group_by( ID) %>%
  filter(time==max(time))

# Extracting which zone each Individiual spent most time at in total
cumpref<-cumtime %>%
  filter(zone!="Non visible") %>%
  group_by( ID) %>%
  filter(time==max(time))


```

## Plotting

### Preference per "single stay" 

```{r}
# Preference per single stay
behp<-behpref%>%
  group_by(stage) %>%
  summarize(meantrial=mean(meantemptrial),trialsd=sd(meantemptrial), n=length(meantemptrial),meanall=mean(meantempall),allsd=sd(meantempall), n2=length(meantempall)) %>%
  mutate(trialse=trialsd/sqrt(n),
         allse=allsd/sqrt(n2))

# For trial temps
ggplot(behp, aes(y=meantrial, x=stage) )+
    geom_jitter(behpref, mapping=aes(x=stage, y=meantemptrial, color=stage),shape=1, size=3, stroke=1.2, width=0.1) +
  geom_point(size=3, color="black", position=position_nudge(x=0.2)) +geom_errorbar(aes(ymin=meantrial-trialse, ymax=meantrial+trialse), width=.2,
                 position=position_nudge(x=0.2), color="black")  + theme_classic()+
  scale_color_manual(values=colors)+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none")+ xlab("Stage")+  ylab("Temperature (Celsius)")

ggsave(plot=last_plot(),filename="Pref_trialtemps.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")

ggplot(behpref, aes(x=stage, y=meantemptrial, color=stage)) +
  geom_boxplot() +
  theme_classic()+
  scale_color_manual(values=colors)+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none") + xlab("Stage")+  ylab("Temperature (Celsius)")
ggsave(plot=last_plot(),filename="Pref_trialtemps_boxplot.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")


# For all temps
ggplot(behp, aes(y=meanall, x=stage) )+
    geom_jitter(behpref, mapping=aes(x=stage, y=meantempall, color=stage),shape=1, size=3, stroke=1.2, width=0.1) +
  geom_point(size=3, color="black", position=position_nudge(x=0.2)) +geom_errorbar(aes(ymin=meanall-allse, ymax=meanall+allse), width=.2,
                 position=position_nudge(x=0.2), color="black")  + theme_classic()+
  scale_color_manual(values=colors)+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none") + xlab("Stage")+  ylab("Temperature (Celsius)")

ggsave(plot=last_plot(),filename="Pref_alltemps.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")

ggplot(behpref, aes(x=stage, y=meantempall, color=stage)) +
  geom_boxplot() +
  theme_classic()+
  scale_color_manual(values=colors)+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none") + xlab("Stage")+  ylab("Temperature (Celsius)")

ggsave(plot=last_plot(),filename="Pref_alltemps_boxplot.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")


```

### Preference per "cumulative stay"  

```{r}

cumpref2<-cumpref %>%
  group_by(stage) %>%
  summarize(meanall=mean(meantempall),allsd=sd(meantempall), n=length(meantempall)) %>%
  mutate(allse=allsd/sqrt(n))

# For all temps
ggplot(cumpref2, aes(y=meanall, x=stage) )+
    geom_jitter(cumpref, mapping=aes(x=stage, y=meantempall, color=stage),shape=1, size=3, stroke=1.2, width=0.1) +
  geom_point(size=3, color="black", position=position_nudge(x=0.2)) +geom_errorbar(aes(ymin=meanall-allse, ymax=meanall+allse), width=.2,
                 position=position_nudge(x=0.2), color="black")  + theme_classic()+
  scale_color_manual(values=colors)+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none")+ xlab("Stage")+  ylab("Temperature (Celsius)")

ggsave(plot=last_plot(),filename="Prefcum_alltemps.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")


ggplot(cumpref, aes(x=stage, y=meantempall, color=stage)) +
  geom_boxplot() +
  theme_classic()+
  scale_color_manual(values=colors)+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none") + xlab("Stage")+  ylab("Temperature (Celsius)")
ggsave(plot=last_plot(),filename="Prefcum_alltemps_boxplot.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")




```






# ###############################################################################################################################################################################


# IGNORE: Draft pieces of code

#### Plots: proportional time

```{r, eval=FALSE}

## Protonymphs

ggplot(protos2, aes(x=meantemptrial, y=proptime, fill=as.factor(trial.x))) +geom_bar(stat="identity", width=1) + 
  theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"))+
  xlab("Temperature (Celsius)")+  ylab("Cumulative time (s)")+ ggtitle("Protonymphs by ID")+
  labs(fill="Trial")+ 
  facet_wrap(vars(ID), scales="fixed")+ geom_vline(xintercept=35, linetype="dashed", color="black")

ggsave(plot=last_plot(),filename="Acummtimeprop_ind_trial_Protos.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")



## Deutonymphs
ggplot(deutos2, aes(x=meantemptrial, y=proptime, fill=as.factor(trial.x))) +geom_bar(stat="identity", width=1) + 
  theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"))+
  xlab("Temperature (Celsius)")+  ylab("Cumulative time (s)")+ ggtitle("Deutonymphs by ID")+
  labs(fill="Trial")+ 
  facet_wrap(vars(ID), scales="fixed")+ geom_vline(xintercept=35, linetype="dashed", color="black")

ggsave(plot=last_plot(),filename="Acummtimeprop_ind_trial_Deutos.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")




## Tritonymphs
ggplot(tritos2, aes(x=meantemptrial, y=proptime, fill=as.factor(trial.x))) +geom_bar(stat="identity", width=1) + 
  theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"))+
  xlab("Temperature (Celsius)")+  ylab("Cumulative time (s)")+ ggtitle("Tritonymphs by ID")+
  labs(fill="Trial")+ 
  facet_wrap(vars(ID), scales="fixed")+ geom_vline(xintercept=35, linetype="dashed", color="black")

ggsave(plot=last_plot(),filename="Acummtimeprop_ind_trial_tritos.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")





## Males
ggplot(males2, aes(x=meantemptrial, y=proptime, fill=as.factor(trial.x))) +geom_bar(stat="identity", width=1) + 
  theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"))+
  xlab("Temperature (Celsius)")+  ylab("Cumulative time (s)")+ ggtitle("Males by ID")+
  labs(fill="Trial")+ 
  facet_wrap(vars(ID), scales="fixed")+ geom_vline(xintercept=35, linetype="dashed", color="black")

ggsave(plot=last_plot(),filename="Acummtimeprop_ind_trial_males.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")




## Females
ggplot(females2, aes(x=meantemptrial, y=proptime, fill=as.factor(trial.x))) +geom_bar(stat="identity", width=1) + 
  theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"))+
  xlab("Temperature (Celsius)")+  ylab("Cumulative time (s)")+ ggtitle("Females by ID")+
  labs(fill="Trial")+ 
  facet_wrap(vars(ID), scales="fixed")+ geom_vline(xintercept=35, linetype="dashed", color="black")

ggsave(plot=last_plot(),filename="Acummtimeprop_ind_trial_females.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")


```

#### Plots: proportional Cumulative time

```{r}
acum<-beh %>%
  group_by(stage, meantempall) %>%
  summarize(acumsum=sum(time), acumprop=sum(proptime))

ggplot(acum, aes(x=meantempall, y=acumsum, fill=stage)) +geom_bar(stat="identity") + 
  theme_classic()+
  scale_fill_manual(values=colors)+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none")+
  xlab("Temperature (Celsius)")+  ylab("Cumulative total time")+ 
  facet_wrap(~stage, scales="fixed")+ geom_vline(xintercept=35, linetype="dashed", color="black")

ggsave(plot=last_plot(),filename="Acummtime_all.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")

ggplot(acum, aes(x=meantempall, y=acumprop, fill=stage)) +geom_bar(stat="identity") + 
  theme_classic()+
  scale_fill_manual(values=colors)+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none")+
  xlab("Temperature (Celsius)")+  ylab("Cumulative prop time")+ 
  facet_wrap(~stage, scales="fixed")+ geom_vline(xintercept=35, linetype="dashed", color="black")

ggsave(plot=last_plot(),filename="Acummproptime_all.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")

ggplot(beh, aes(x=meantempall, y=time, color=stage)) +
  geom_point(shape=1, size=2) + facet_wrap(~stage)+
theme_classic()+
  scale_color_manual(values=colors)+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none")+
  xlab("Temperature (Celsius)")+  ylab("Time (sec)")+ geom_vline(xintercept=35, linetype="dashed", color="black")

ggsave(plot=last_plot(),filename="Raw_all.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")


```



```{r}
### Protonymphs
ggplot(protos3, aes(x=meantempall, y=proptime)) +geom_bar(stat="identity", fill="#ff7f00") + 
  theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)), strip.text.x = element_blank(),panel.spacing = unit(7, "mm"),legend.position="none")+
  xlab("Temperature (Celsius)")+  ylab("Cumulative proportional time")+ ggtitle("Protonymphs all together")

ggsave(plot=last_plot(),filename="Acummtimeprop_trial_Protos.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")

### Deutonymphs
ggplot(deutos3, aes(x=meantempall, y=proptime)) +geom_bar(stat="identity", fill="#e41a1c") + 
  theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)), strip.text.x = element_blank(),panel.spacing = unit(7, "mm"),legend.position="none")+
  xlab("Temperature (Celsius)")+  ylab("Cumulative proportional time")+ ggtitle("Deutonymphs all together")
ggsave(plot=last_plot(),filename="Acummtimeprop_trial_Deutos.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")


### Tritonymphs
ggplot(tritos3, aes(x=meantempall, y=proptime)) +geom_bar(stat="identity", fill="#a65628") + 
  theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)), strip.text.x = element_blank(),panel.spacing = unit(7, "mm"),legend.position="none")+
  xlab("Temperature (Celsius)")+  ylab("Cumulative proportional time")+ ggtitle("Tritonymphs all together")

ggsave(plot=last_plot(),filename="Acummtimeprop_trial_tritos.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")


### Males
ggplot(males3, aes(x=meantempall, y=proptime)) +geom_bar(stat="identity", fill="#984ea3") + 
  theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)), strip.text.x = element_blank(),panel.spacing = unit(7, "mm"),legend.position="none")+
  xlab("Temperature (Celsius)")+  ylab("Cumulative proportional time")+ ggtitle("Males all together")

ggsave(plot=last_plot(),filename="Acummtimeprop_trial_males.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")

### Females
ggplot(females3, aes(x=meantempall, y=proptime)) +geom_bar(stat="identity", fill="#377eb8") + 
  theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)), strip.text.x = element_blank(),panel.spacing = unit(7, "mm"),legend.position="none")+
  xlab("Temperature (Celsius)")+  ylab("Cumulative proportional time")+ ggtitle("Females all together")

ggsave(plot=last_plot(),filename="Acummtimeprop_trial_females.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")



```


## Per trial


```{r}
#Trial 2
t2<-beh %>% filter(trial.x==2)

t22<-t2%>%
  group_by(ID,stage, meantemptrial, zone) %>%
  summarize(time=sum(time), proptime=sum(proptime))

t23<-t2%>%
  group_by(stage,meantempall, zone) %>%
  summarize(time=sum(time), proptime=sum(proptime))

levels(t22$stage)
## Cumulative time

### By individual
ggplot(t22, aes(x=meantemptrial, y=time, fill=stage)) +geom_bar(stat="identity") + 
  theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)), strip.text.x = element_blank(),panel.spacing = unit(7, "mm"),legend.position="none")+
  xlab("Temperature (Celsius)")+  ylab("Cumulative time (s)")+ ggtitle("Trial 2 per ind")+
  scale_fill_manual(values=colors)+
  facet_wrap(vars(ID))

ggsave(plot=last_plot(),filename="Acummtime_ind_trial_2.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")


### Total among all individuals
ggplot(t23, aes(x=meantempall, y=time, fill=stage)) +geom_bar(stat="identity") + 
  theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none")+
  xlab("Temperature (Celsius)")+  ylab("Cumulative time (s)")+ ggtitle("Trial 2")+
  scale_fill_manual(values=colors) +
  facet_wrap(vars(stage))

ggsave(plot=last_plot(),filename="Acummtime_trial_2.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")


## Cumulative proportional time

### By individual

ggplot(t22, aes(x=meantemptrial, y=proptime, fill=stage)) +geom_bar(stat="identity") + 
  theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)), strip.text.x = element_blank(),panel.spacing = unit(7, "mm"),legend.position="none")+
  xlab("Temperature (Celsius)")+  ylab("Cumulative time (s)")+ ggtitle("Trial 2 per ind")+
  scale_fill_manual(values=colors)+
  facet_wrap(vars(ID))

ggsave(plot=last_plot(),filename="Acummtimeprop_ind_trial_2.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")


### Total among all individuals
ggplot(t23, aes(x=meantempall, y=time, fill=stage)) +geom_bar(stat="identity") + 
  theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none")+
  xlab("Temperature (Celsius)")+  ylab("Cumulative time (s)")+ ggtitle("Trial 2")+
  scale_fill_manual(values=colors)
  facet_wrap(vars(stage))

ggsave(plot=last_plot(),filename="Acummtimeprop_trial_2.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")


```


## Protonymphs
```{r, eval=FALSE, echo=FALSE}
### Protonymphs
protoshc<-protos%>%
  group_by(half) %>%
  summarize(timesum=sum(time), proptimesum=sum(proptime), timeav=mean(time),timesd=sd(time), n=length(time), proptimeav=mean(proptime), proptimesd=sd(proptime), n2=length(proptime)) %>%
  mutate(timese=timesd/sqrt(n),
         timeav2=timesum/n,
         timese=timesd/sqrt(n),
         proptimese=proptimesd/sqrt(n2))

ggplot(protoshc, aes(y=timesum, x=half))+
  geom_bar(stat="identity",fill=colors[1])+
   theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none")+ ggtitle("Protonymphs")
ggsave(plot=last_plot(),filename="Half_proto_ttime.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")
 

ggplot(protoshc, aes(y=proptimesum, x=half))+
  geom_bar(stat="identity",fill=colors[1])+ theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none")+ ggtitle("Protonymphs")
ggsave(plot=last_plot(),filename="Half_proto_proptime.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")

ggplot(protoshc, aes(y=timeav, x=half))+
    geom_jitter(protos, mapping=aes(x=half, y=time),shape=1, size=3, stroke=1.2, width=0.1) +
  geom_point(color=colors[1], size=3) +geom_errorbar(aes(ymin=timeav-timese, ymax=timeav+timese), width=.2,
                 position=position_dodge(.9), color=colors[1])  + theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none")+ ggtitle("Protonymphs")
ggsave(plot=last_plot(),filename="Half_proto_avtime.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")
 

ggplot(protoshc, aes(y=timeav, x=half))+
    #geom_jitter(protos, mapping=aes(x=half, y=time),shape=1, size=3, stroke=1.2, width=0.1) +
  geom_point(color=colors[1], size=3) +geom_errorbar(aes(ymin=timeav-timese, ymax=timeav+timese), width=.2,
                 position=position_dodge(.9), color=colors[1]) +  theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none")+ ggtitle("Protonymphs")
ggsave(plot=last_plot(),filename="Half_proto_avtime2.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")
 

ggplot(protoshc, aes(y=proptimeav, x=half))+
    geom_jitter(protos, mapping=aes(x=half, y=proptime),shape=1, size=3, stroke=1.2, width=0.1) +
  geom_point(color=colors[1], size=3) +geom_errorbar(aes(ymin=proptimeav-proptimese, ymax=proptimeav+proptimese), width=.2,
                 position=position_dodge(.9), color=colors[1])  + theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none")+ ggtitle("Protonymphs")
ggsave(plot=last_plot(),filename="Half_proto_avproptime.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")
 

ggplot(protoshc, aes(y=proptimeav, x=half))+
    #geom_jitter(protos, mapping=aes(x=half, y=time),shape=1, size=3, stroke=1.2, width=0.1) +
  geom_point(color=colors[1], size=3) +geom_errorbar(aes(ymin=proptimeav-proptimese, ymax=proptimeav+proptimese), width=.2,
                 position=position_dodge(.9), color=colors[1]) +  theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none")+ ggtitle("Protonymphs")
ggsave(plot=last_plot(),filename="Half_proto_avproptime2.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")
 



```


## Deutonymphs
```{r, eval=FALSE, echo=FALSE}

deutoshc<-deutos%>%
  group_by(half) %>%
  summarize(timesum=sum(time), proptimesum=sum(proptime), timeav=mean(time),timesd=sd(time), n=length(time), proptimeav=mean(proptime), proptimesd=sd(proptime), n2=length(proptime)) %>%
  mutate(timese=timesd/sqrt(n),
         timeav2=timesum/n,
         timese=timesd/sqrt(n),
         proptimese=proptimesd/sqrt(n2))

ggplot(deutoshc, aes(y=timesum, x=half))+
  geom_bar(stat="identity",fill=colors[2])+
   theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none")+ ggtitle("deutonymphs")
ggsave(plot=last_plot(),filename="Half_deuto_ttime.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")
 

ggplot(deutoshc, aes(y=proptimesum, x=half))+
  geom_bar(stat="identity",fill=colors[2])+ theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none")+ ggtitle("deutonymphs")
ggsave(plot=last_plot(),filename="Half_deuto_proptime.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")

ggplot(deutoshc, aes(y=timeav, x=half))+
    geom_jitter(deutos, mapping=aes(x=half, y=time),shape=1, size=3, stroke=1.2, width=0.1) +
  geom_point(color=colors[2], size=3) +geom_errorbar(aes(ymin=timeav-timese, ymax=timeav+timese), width=.2,
                 position=position_dodge(.9), color=colors[2])  + theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none")+ ggtitle("deutonymphs")
ggsave(plot=last_plot(),filename="Half_deuto_avtime.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")
 

ggplot(deutoshc, aes(y=timeav, x=half))+
    #geom_jitter(deutos, mapping=aes(x=half, y=time),shape=1, size=3, stroke=1.2, width=0.1) +
  geom_point(color=colors[2], size=3) +geom_errorbar(aes(ymin=timeav-timese, ymax=timeav+timese), width=.2,
                 position=position_dodge(.9), color=colors[2]) +  theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none")+ ggtitle("deutonymphs")
ggsave(plot=last_plot(),filename="Half_deuto_avtime2.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")
 

ggplot(deutoshc, aes(y=proptimeav, x=half))+
    geom_jitter(deutos, mapping=aes(x=half, y=proptime),shape=1, size=3, stroke=1.2, width=0.1) +
  geom_point(color=colors[2], size=3) +geom_errorbar(aes(ymin=proptimeav-proptimese, ymax=proptimeav+proptimese), width=.2,
                 position=position_dodge(.9), color=colors[2])  + theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none")+ ggtitle("deutonymphs")
ggsave(plot=last_plot(),filename="Half_deuto_avproptime.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")
 

ggplot(deutoshc, aes(y=proptimeav, x=half))+
    #geom_jitter(deutos, mapping=aes(x=half, y=time),shape=1, size=3, stroke=1.2, width=0.1) +
  geom_point(color=colors[2], size=3) +geom_errorbar(aes(ymin=proptimeav-proptimese, ymax=proptimeav+proptimese), width=.2,
                 position=position_dodge(.9), color=colors[2]) +  theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none")+ ggtitle("deutonymphs")
ggsave(plot=last_plot(),filename="Half_deuto_avproptime2.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")
 



```


## All stages at once
```{r}
behch<-beh%>%
  group_by(stage,half) %>%
  summarize(timesum=sum(time), proptimesum=sum(proptime), timeav=mean(time),timesd=sd(time), n=length(time), proptimeav=mean(proptime), proptimesd=sd(proptime), n2=length(proptime)) %>%
  mutate(timese=timesd/sqrt(n),
         timeav2=timesum/n,
         timese=timesd/sqrt(n),
         proptimese=proptimesd/sqrt(n2))

ggplot(behch, aes(y=timesum, x=half, fill=stage))+
  geom_bar(stat="identity")+
  scale_fill_manual(values=colors)+
   theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none")+ 
  facet_wrap(~stage)
ggsave(plot=last_plot(),filename="Half_all_ttime.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")
 

ggplot(behch, aes(y=proptimesum, x=half, fill=stage))+
  scale_fill_manual(values=colors)+
  geom_bar(stat="identity")+ 
  theme_classic()+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none")+ 
facet_wrap(~stage)
  ggsave(plot=last_plot(),filename="Half_all_proptime.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")


ggplot(behch, aes(y=timeav, x=half, color=stage))+
    geom_jitter(beh, mapping=aes(x=half, y=time, color=stage),shape=1, size=3, stroke=1.2, width=0.1) +
  geom_point(size=3, color="black") +geom_errorbar(aes(ymin=timeav-timese, ymax=timeav+timese), width=.2,
                 position=position_dodge(.9), color="black")  + theme_classic()+
  scale_color_manual(values=colors)+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none")+ 
  facet_wrap(~stage)
ggsave(plot=last_plot(),filename="Half_all_avtime.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")
 

ggplot(behch, aes(y=timeav, x=half, color=stage))+
    geom_point(size=3) +geom_errorbar(aes(ymin=timeav-timese, ymax=timeav+timese), width=.2,
                 position=position_dodge(.9))  + theme_classic()+
  scale_color_manual(values=colors)+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none")+ 
  facet_wrap(~stage)
ggsave(plot=last_plot(),filename="Half_all_avtime2.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")
 

ggplot(behch, aes(y=proptimeav, x=half, color=stage))+
    geom_jitter(beh, mapping=aes(x=half, y=proptime, color=stage),shape=1, size=3, stroke=1.2, width=0.1) +
  geom_point(size=3, color="black") +geom_errorbar(aes(ymin=proptimeav-proptimese, ymax=proptimeav+proptimese), width=.2,
                 position=position_dodge(.9), color="black")  + theme_classic()+
  scale_color_manual(values=colors)+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none")+ 
  facet_wrap(~stage)
ggsave(plot=last_plot(),filename="Half_all_avproptime.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")
 

ggplot(behch, aes(y=proptimeav, x=half, color=stage))+
     geom_point(size=3) +geom_errorbar(aes(ymin=proptimeav-proptimese, ymax=proptimeav+proptimese), width=.2,
                 position=position_dodge(.9))  + theme_classic()+
  scale_color_manual(values=colors)+
  theme(text = element_text(size = 15), plot.title = element_text(size = (12)),panel.spacing = unit(7, "mm"),legend.position="none")+ 
  facet_wrap(~stage)
ggsave(plot=last_plot(),filename="Half_all_avproptime2.jpg",  path="Outputs/Exploratory plots/",width=7, height=7, units="in")
 



```